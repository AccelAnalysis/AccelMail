<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Target Market Discovery | Accel Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        
        /* Custom scrollbar for sidebar */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .transition-width {
            transition: width 0.5s ease-in-out;
        }

        /* Custom Radio/Checkbox Styles */
        .custom-radio:checked + div {
            border-color: #2563EB; /* Blue-600 */
            background-color: #EFF6FF; /* Blue-50 */
            color: #1E3A8A;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-6 shadow-sm z-20 relative">
        <div class="flex items-center gap-3">
            <img src="https://img1.wsimg.com/isteam/ip/0815fdc9-aafc-4fe1-99f8-dedc9ba0e23b/blob-f3ca1db.png/:/rs=w:166,h:200,cg:true,m/cr=w:166,h:200/qt=q:95" alt="Accel Analysis Logo" class="h-10 w-auto">
            <span class="font-bold text-xl tracking-tight text-slate-800 hidden md:block">Accel Analysis</span>
        </div>
        <div class="text-sm font-medium text-slate-500">Target Market Discovery</div>
    </header>

    <!-- Main Layout -->
    <div class="flex flex-1 overflow-hidden relative">
        
        <!-- Sidebar Navigation (Desktop) -->
        <aside class="w-64 bg-slate-900 text-slate-300 flex-col hidden md:flex overflow-y-auto z-10">
            <div class="p-6">
                <h3 class="text-xs uppercase tracking-wider font-semibold text-slate-500 mb-4">Sections</h3>
                <nav class="space-y-1" id="desktop-nav">
                    <!-- Nav items generated by JS -->
                </nav>
            </div>
            
            <div class="mt-auto p-6 border-t border-slate-800">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-xs">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <p class="text-xs font-medium text-white">Client Mode</p>
                        <p class="text-[10px] text-slate-500">Confidential Survey</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Mobile Nav Drawer Toggle -->
        <div class="md:hidden absolute top-4 right-4 z-50">
            <button id="mobile-menu-btn" class="bg-white p-2 rounded-md shadow text-slate-600">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- Content Area -->
        <main class="flex-1 flex flex-col relative overflow-hidden bg-slate-50">
            
            <!-- Hero Background for Aesthetics -->
            <div class="absolute inset-0 z-0 opacity-10 pointer-events-none">
                <img src="https://img1.wsimg.com/isteam/ip/0815fdc9-aafc-4fe1-99f8-dedc9ba0e23b/blob-02576cc.png/:/rs=w:1440,h:1440/" class="w-full h-full object-cover" alt="Background">
            </div>

            <!-- Progress Bar -->
            <div class="h-1 bg-slate-200 z-20 w-full">
                <div id="progress-bar" class="h-full bg-blue-600 transition-width w-0"></div>
            </div>

            <!-- Scrollable Form Container -->
            <div id="form-container" class="flex-1 overflow-y-auto p-4 md:p-8 z-10 scroll-smooth">
                <div class="max-w-3xl mx-auto space-y-8 pb-20">
                    
                    <form id="discovery-form" onsubmit="return false;">
                        <!-- Sections will be injected here by JS -->
                    </form>

                </div>
            </div>

            <!-- Footer Controls -->
            <div class="bg-white border-t border-slate-200 p-4 z-20 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                <div class="max-w-3xl mx-auto flex justify-between items-center">
                    <button id="prev-btn" class="px-6 py-2 rounded-lg text-slate-600 font-medium hover:bg-slate-100 transition disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-arrow-left mr-2"></i> Previous
                    </button>
                    
                    <div class="text-sm text-slate-500 font-medium">
                        Step <span id="current-step-display">1</span> of <span id="total-steps-display">10</span>
                    </div>

                    <button id="next-btn" class="px-6 py-2 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition shadow-lg shadow-blue-600/20">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

        </main>
    </div>

    <!-- Submission Modal -->
    <div id="submit-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 hidden flex items-center justify-center opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 text-center transform scale-95 transition-transform duration-300" id="submit-modal-content">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                <i class="fas fa-check"></i>
            </div>
            <h2 class="text-2xl font-bold text-slate-900 mb-2">Analysis Complete</h2>
            <p class="text-slate-600 mb-6">Your target market profile has been saved.</p>
            <p class="text-sm text-slate-500 mb-6">You can now close this tab and return to the main form.</p>
            <button onclick="window.close()" class="w-full py-3 bg-slate-900 text-white rounded-lg font-medium hover:bg-slate-800 transition">
                Close Window
            </button>
        </div>
    </div>

    <script>
        // --- DATA STRUCTURES ---
        
        const audienceSection = {
            id: "s0",
            title: "Audience Type",
            icon: "fa-users",
            content: `
                <div class="space-y-6">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-900">Who is your target?</h2>
                        <p class="text-slate-500 mt-2">Select your primary audience to customize this survey.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto">
                        <label class="cursor-pointer group">
                            <input type="radio" name="audience_type" value="B2B" class="peer sr-only" onchange="updateSurveyMode('B2B')">
                            <div class="p-8 border-2 border-slate-200 rounded-2xl hover:border-blue-500 hover:bg-blue-50 transition text-center h-full peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:ring-2 peer-checked:ring-blue-500 peer-checked:ring-offset-2">
                                <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                                    <i class="fas fa-building"></i>
                                </div>
                                <h3 class="text-xl font-bold text-slate-900 mb-2">Business to Business (B2B)</h3>
                                <p class="text-slate-500 text-sm">I am targeting other businesses, companies, or organizations.</p>
                            </div>
                        </label>
                        <label class="cursor-pointer group">
                            <input type="radio" name="audience_type" value="B2C" class="peer sr-only" onchange="updateSurveyMode('B2C')">
                            <div class="p-8 border-2 border-slate-200 rounded-2xl hover:border-green-500 hover:bg-green-50 transition text-center h-full peer-checked:border-green-600 peer-checked:bg-green-50 peer-checked:ring-2 peer-checked:ring-green-500 peer-checked:ring-offset-2">
                                <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                                    <i class="fas fa-user-friends"></i>
                                </div>
                                <h3 class="text-xl font-bold text-slate-900 mb-2">Business to Consumer (B2C)</h3>
                                <p class="text-slate-500 text-sm">I am targeting individual consumers, households, or residents.</p>
                            </div>
                        </label>
                    </div>
                </div>
            `
        };

        const b2bSections = [
            {
                id: "s1",
                title: "Industry Focus",
                icon: "fa-industry",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Business Model & Industry</h2>
                            <p class="text-slate-500 mt-2">Identify industries with the greatest bookkeeping need.</p>
                        </div>
                        
                        <!-- Question 1.1 -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">1. High Priority Industries</label>
                            <p class="text-sm text-slate-500 mb-4">Select all broad industries you wish to target.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="industry-selection">
                                <!-- Generated via JS -->
                            </div>
                        </div>

                        <!-- Question 1.2 (Dynamic Matrix) -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200" id="industry-matrix-container" style="display:none;">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">2. Industry Classification</label>
                            <p class="text-sm text-slate-500 mb-4">Classify your selected industries.</p>
                            <div class="space-y-3" id="industry-matrix">
                                <!-- Dynamic Content -->
                            </div>
                        </div>

                        <!-- Question 1.3 -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-2">3. Industries to Avoid</label>
                            <textarea name="s1_avoid" rows="3" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="E.g., Crypto, Cannabis, etc."></textarea>
                        </div>

                         <!-- Question 1.4 -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-2">4. Current Expertise Level (1-5)</label>
                            <p class="text-sm text-slate-500 mb-4">How comfortable is your team with the nuances of these industries?</p>
                            <input type="range" name="s1_expertise" min="1" max="5" value="3" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                            <div class="flex justify-between text-xs text-slate-500 mt-2">
                                <span>Novice</span>
                                <span>Expert</span>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s2",
                title: "Company Size",
                icon: "fa-chart-pie",
                content: `
                    <div class="space-y-6">
                         <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Revenue & Complexity</h2>
                            <p class="text-slate-500 mt-2">Defining the financial sweet spot.</p>
                        </div>

                        <!-- Revenue Range -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">5. Ideal Annual Revenue Range</label>
                            <div class="space-y-4" id="revenue-matrix">
                                <!-- JS Generated Matrix -->
                            </div>
                        </div>

                        <!-- Employee Count -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">8. Ideal Employee Count</label>
                             <div class="space-y-4" id="employee-matrix">
                                <!-- JS Generated Matrix -->
                            </div>
                        </div>
                        
                        <!-- Complexity -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">9. Operational "Sweet Spot" Indicators</label>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">
                                    <input type="checkbox" name="s2_complexity" value="Payroll" class="w-5 h-5 text-blue-600 rounded">
                                    <span>Runs Payroll</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">
                                    <input type="checkbox" name="s2_complexity" value="Inventory/Job Costing" class="w-5 h-5 text-blue-600 rounded">
                                    <span>Uses Inventory or Job-Costing</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">
                                    <input type="checkbox" name="s2_complexity" value="Multiple Locations" class="w-5 h-5 text-blue-600 rounded">
                                    <span>Multiple Locations / Cost Centers</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 border border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">
                                    <input type="checkbox" name="s2_complexity" value="High Volume Invoices" class="w-5 h-5 text-blue-600 rounded">
                                    <span>High Volume Invoicing</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s3",
                title: "Age & Stage",
                icon: "fa-hourglass-half",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Age & Stage</h2>
                            <p class="text-slate-500 mt-2">Maturity of the business lifecycle.</p>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">10. Target Business Stages</label>
                            <div class="space-y-4" id="stage-matrix">
                                <!-- JS Generated -->
                            </div>
                        </div>

                         <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">11. Where do you add the most value?</label>
                            <div class="grid grid-cols-1 gap-3">
                                <label class="flex items-center gap-3"><input type="checkbox" name="s3_value" value="Setup" class="w-4 h-4 text-blue-600"> Setting up books from scratch</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s3_value" value="Cleanup" class="w-4 h-4 text-blue-600"> Cleaning up messy historical books</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s3_value" value="Maintenance" class="w-4 h-4 text-blue-600"> Ongoing monthly maintenance</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s3_value" value="Advisory" class="w-4 h-4 text-blue-600"> CFO-level Advisory</label>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s4",
                title: "Structure",
                icon: "fa-sitemap",
                content: `
                    <div class="space-y-6">
                         <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Ownership & Structure</h2>
                            <p class="text-slate-500 mt-2">Defining the organizational complexity.</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">13. Company Types</label>
                            <div class="space-y-4" id="structure-matrix">
                                <!-- JS Generated -->
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">14. Decision Maker Preference</label>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3"><input type="radio" name="s4_decision" value="Owner" class="w-4 h-4 text-blue-600"> Owner is decision-maker</label>
                                <label class="flex items-center gap-3"><input type="radio" name="s4_decision" value="FinanceMgr" class="w-4 h-4 text-blue-600"> Report to Finance Manager/Controller</label>
                                <label class="flex items-center gap-3"><input type="radio" name="s4_decision" value="Either" class="w-4 h-4 text-blue-600"> Either is fine</label>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s5",
                title: "Geography",
                icon: "fa-map-marked-alt",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Geography</h2>
                            <p class="text-slate-500 mt-2">Where do your ideal clients operate?</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">16. Service Range</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <label class="cursor-pointer">
                                    <input type="radio" name="s5_geo" value="Local" class="peer sr-only custom-radio">
                                    <div class="p-4 border rounded-lg hover:bg-slate-50 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition text-center">
                                        <div class="font-semibold">Local Only</div>
                                        <div class="text-xs text-slate-500">Hampton Roads</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="s5_geo" value="Regional" class="peer sr-only custom-radio">
                                    <div class="p-4 border rounded-lg hover:bg-slate-50 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition text-center">
                                        <div class="font-semibold">Regional</div>
                                        <div class="text-xs text-slate-500">VA & Neighbors</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="s5_geo" value="National" class="peer sr-only custom-radio">
                                    <div class="p-4 border rounded-lg hover:bg-slate-50 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition text-center">
                                        <div class="font-semibold">National</div>
                                        <div class="text-xs text-slate-500">Anywhere US</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-2">17. Specific Priority Areas</label>
                            <input type="text" name="s5_priority" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="Specific Cities, States, or Zip Codes">
                        </div>
                    </div>
                `
            },
            {
                id: "s6",
                title: "Facilities",
                icon: "fa-building",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Facilities & Assets</h2>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">20. Facility Types</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center gap-3 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="s6_facility" value="Office" class="w-4 h-4 text-blue-600"> Professional Offices</label>
                                <label class="flex items-center gap-3 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="s6_facility" value="Retail" class="w-4 h-4 text-blue-600"> Retail Storefronts</label>
                                <label class="flex items-center gap-3 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="s6_facility" value="Restaurant" class="w-4 h-4 text-blue-600"> Restaurants/Food</label>
                                <label class="flex items-center gap-3 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="s6_facility" value="Warehouse" class="w-4 h-4 text-blue-600"> Warehouse/Distribution</label>
                                <label class="flex items-center gap-3 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="s6_facility" value="Manufacturing" class="w-4 h-4 text-blue-600"> Manufacturing Plants</label>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s7",
                title: "Risk & Profile",
                icon: "fa-shield-alt",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Risk & Profile</h2>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">22. Importance of Financial Stability</label>
                            <select name="s7_stability" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Critical">Critical - Only stable clients</option>
                                <option value="Flexible">Important but flexible</option>
                                <option value="NotFactor">Not a major factor (willing to cleanup)</option>
                            </select>
                        </div>

                         <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">24. Mission Fit / Priorities</label>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3"><input type="checkbox" name="s7_mission" value="MinorityOwned" class="w-4 h-4 text-blue-600"> Minority-owned businesses</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s7_mission" value="WomenOwned" class="w-4 h-4 text-blue-600"> Women-owned businesses</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s7_mission" value="VeteranOwned" class="w-4 h-4 text-blue-600"> Veteran-owned businesses</label>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s8",
                title: "Digital & Compliance",
                icon: "fa-laptop-code",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Digital Presence & Compliance</h2>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">27. Existing Tech Stack Preference</label>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_tech" value="AccountingSoftware" class="w-4 h-4 text-blue-600"> Already use Accounting Software (QBO/Xero)</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_tech" value="POS" class="w-4 h-4 text-blue-600"> Use POS/Inventory Systems</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_tech" value="OnlinePay" class="w-4 h-4 text-blue-600"> Online Invoicing/Payments</label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">28. Compliance Complexity</label>
                            <p class="text-sm text-slate-500 mb-4">Select types you are comfortable supporting:</p>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_comp" value="Audited" class="w-4 h-4 text-blue-600"> Regularly Audited</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_comp" value="ImportExport" class="w-4 h-4 text-blue-600"> Import/Export Activities</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s8_comp" value="GovContractor" class="w-4 h-4 text-blue-600"> Government Contractors / Grants</label>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                id: "s9",
                title: "Service Needs",
                icon: "fa-hands-helping",
                content: `
                    <div class="space-y-6">
                         <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Service Engagement</h2>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">30. Non-Negotiable Services</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="Bookkeeping" checked class="w-4 h-4 text-blue-600"> Monthly Bookkeeping</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="Payroll" class="w-4 h-4 text-blue-600"> Payroll</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="AR" class="w-4 h-4 text-blue-600"> A/R (Invoicing)</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="AP" class="w-4 h-4 text-blue-600"> A/P (Bill Pay)</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="Cleanup" class="w-4 h-4 text-blue-600"> Cleanup/Catch-up</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="s9_service" value="Advisory" class="w-4 h-4 text-blue-600"> CFO/Advisory</label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">32. Volume Strategy</label>
                            <div class="space-y-3">
                                <label class="flex items-center gap-3 p-3 border rounded-lg hover:bg-slate-50 cursor-pointer">
                                    <input type="radio" name="s9_volume" value="Volume" class="w-4 h-4 text-blue-600">
                                    <span>High volume of small/medium retainers</span>
                                </label>
                                <label class="flex items-center gap-3 p-3 border rounded-lg hover:bg-slate-50 cursor-pointer">
                                    <input type="radio" name="s9_volume" value="Complex" class="w-4 h-4 text-blue-600">
                                    <span>Fewer larger, complex retainers</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `
            }
        ];

        const b2cSections = [
            {
                id: "c1",
                title: "Demographics",
                icon: "fa-user-group",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Consumer Demographics</h2>
                            <p class="text-slate-500 mt-2">Who is your ideal individual customer?</p>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">1. Age Range Target</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                <label class="flex items-center gap-2 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="c1_age" value="18-24" class="rounded text-green-600"> 18-24 (Gen Z)</label>
                                <label class="flex items-center gap-2 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="c1_age" value="25-34" class="rounded text-green-600"> 25-34 (Millennials)</label>
                                <label class="flex items-center gap-2 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="c1_age" value="35-44" class="rounded text-green-600"> 35-44</label>
                                <label class="flex items-center gap-2 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="c1_age" value="45-54" class="rounded text-green-600"> 45-54</label>
                                <label class="flex items-center gap-2 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="c1_age" value="55-64" class="rounded text-green-600"> 55-64</label>
                                <label class="flex items-center gap-2 p-2 border rounded hover:bg-slate-50"><input type="checkbox" name="c1_age" value="65+" class="rounded text-green-600"> 65+ (Seniors)</label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">2. Gender Focus</label>
                            <div class="flex gap-4">
                                <label class="flex items-center gap-2"><input type="radio" name="c1_gender" value="All" checked class="text-green-600"> All / No Preference</label>
                                <label class="flex items-center gap-2"><input type="radio" name="c1_gender" value="Female" class="text-green-600"> Female Focus</label>
                                <label class="flex items-center gap-2"><input type="radio" name="c1_gender" value="Male" class="text-green-600"> Male Focus</label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">3. Household Income</label>
                            <select name="c1_income" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none">
                                <option value="Any">Any Income Level</option>
                                <option value="Budget">Budget Conscious (<k)</option>
                                <option value="Middle">Middle Income (k-k)</option>
                                <option value="Affluent">Affluent (k-k)</option>
                                <option value="Wealthy">High Net Worth (k+)</option>
                            </select>
                        </div>
                    </div>
                `
            },
            {
                id: "c2",
                title: "Lifestyle",
                icon: "fa-heart",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Lifestyle & Interests</h2>
                            <p class="text-slate-500 mt-2">Psychographic details.</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">4. Family Status</label>
                            <div class="space-y-2">
                                <label class="flex items-center gap-3"><input type="checkbox" name="c2_family" value="Singles" class="rounded text-green-600"> Singles</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="c2_family" value="Couples" class="rounded text-green-600"> Couples / Newlyweds</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="c2_family" value="Parents" class="rounded text-green-600"> Parents with Kids</label>
                                <label class="flex items-center gap-3"><input type="checkbox" name="c2_family" value="EmptyNesters" class="rounded text-green-600"> Empty Nesters / Retirees</label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">5. Home Ownership</label>
                            <div class="flex gap-4">
                                 <label class="flex items-center gap-2"><input type="checkbox" name="c2_home" value="Homeowners" class="rounded text-green-600"> Homeowners</label>
                                 <label class="flex items-center gap-2"><input type="checkbox" name="c2_home" value="Renters" class="rounded text-green-600"> Renters</label>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">6. Key Interests</label>
                            <textarea name="c2_interests" rows="3" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none" placeholder="E.g., Golf, Gardening, Tech, DIY, Luxury Travel..."></textarea>
                        </div>
                    </div>
                `
            },
            {
                // Reuse Geography Concept but customized for Consumers
                id: "c3",
                title: "Geography",
                icon: "fa-map-marked-alt",
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-slate-900">Target Geography</h2>
                            <p class="text-slate-500 mt-2">Where do your ideal customers live?</p>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-4">7. Service Range</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <label class="cursor-pointer">
                                    <input type="radio" name="s5_geo" value="Local" class="peer sr-only custom-radio">
                                    <div class="p-4 border rounded-lg hover:bg-slate-50 peer-checked:border-green-500 peer-checked:bg-green-50 transition text-center">
                                        <div class="font-semibold">Local Neighborhoods</div>
                                        <div class="text-xs text-slate-500">Immediate Vicinity</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="s5_geo" value="Regional" class="peer sr-only custom-radio">
                                    <div class="p-4 border rounded-lg hover:bg-slate-50 peer-checked:border-green-500 peer-checked:bg-green-50 transition text-center">
                                        <div class="font-semibold">City / Metro</div>
                                        <div class="text-xs text-slate-500">Whole City Area</div>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="s5_geo" value="National" class="peer sr-only custom-radio">
                                    <div class="p-4 border rounded-lg hover:bg-slate-50 peer-checked:border-green-500 peer-checked:bg-green-50 transition text-center">
                                        <div class="font-semibold">National / Online</div>
                                        <div class="text-xs text-slate-500">Anywhere</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <label class="block text-lg font-semibold text-slate-900 mb-2">8. Specific Zip Codes or Areas</label>
                            <input type="text" name="s5_priority" class="w-full p-3 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-green-500" placeholder="Specific Cities, Neighborhoods, or Zip Codes">
                        </div>
                    </div>
                `
            }
        ];

        const contactSection = {
            id: "s10",
            title: "Contact Info",
            icon: "fa-address-card",
            content: `
                <div class="space-y-6">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-900">Finalize Profile</h2>
                        <p class="text-slate-500 mt-2">Enter your contact details to generate the target market report.</p>
                    </div>
                    
                    <div class="bg-white p-8 rounded-xl shadow-lg border border-slate-200 max-w-xl mx-auto">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">First Name</label>
                                <input type="text" name="firstName" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Last Name</label>
                                <input type="text" name="lastName" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-1">Email Address</label>
                            <input type="email" name="email" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-700 mb-1">Phone Number</label>
                            <input type="tel" name="phone" required class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>

                        <button type="button" onclick="submitForm()" class="w-full py-4 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition shadow-lg shadow-blue-600/30">
                            Complete & Generate Report
                        </button>
                    </div>
                </div>
            `
        };

        // --- CONSTANTS ---
        const industries = [
            "Construction & Trades", "Manufacturing", "Transportation / Logistics",
            "Professional Services", "Medical / Healthcare", "Restaurants & Food",
            "Retail (Brick-and-Mortar)", "E-commerce", "Real Estate / Property Mgmt", "Nonprofits"
        ];

        const revenues = [
            "Under k", "k–k", "k–k", "M–.9M", "M–.9M", "M+"
        ];

        const employees = [
            "0–2 (Micro)", "3–9 (Small Team)", "10–24 (Growing)", "25–49", "50+"
        ];

        const stages = [
            "Startups (0-2 yrs)", "Early Growth (3-5 yrs)", "Established (6-10 yrs)", "Mature (10+ yrs)"
        ];

        const structures = [
            "Independent Local", "Franchises", "Subsidiaries", "Multi-Entity Groups"
        ];

        // --- APP STATE ---
        let currentStep = 0;
        // Default to just Audience Selection initially
        let sections = [audienceSection];
        let formData = {};

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            initSections();
        });

        function initSections() {
            const form = document.getElementById('discovery-form');
            form.innerHTML = sections.map((sec, i) => `
                <div id="section-wrapper-${i}" class="${i === 0 ? 'block' : 'hidden'} animate-fade-in">
                    ${sec.content}
                </div>
            `).join('');
            
            renderNav();
            renderDynamicContent();
            
            // Re-attach listeners
            const indContainer = document.getElementById('industry-selection');
            if(indContainer) indContainer.addEventListener('change', updateIndustryMatrix);
            
            // Attach Nav Listeners
            document.getElementById('prev-btn').onclick = () => jumpToStep(currentStep - 1);
            document.getElementById('next-btn').onclick = () => jumpToStep(currentStep + 1);

            // Mobile menu
            const mobBtn = document.getElementById('mobile-menu-btn');
            if(mobBtn) {
                 mobBtn.onclick = () => {
                    const nav = document.getElementById('desktop-nav').parentElement.parentElement;
                    nav.classList.toggle('hidden');
                    nav.classList.toggle('fixed');
                    nav.classList.toggle('inset-0');
                    nav.classList.toggle('bg-slate-900');
                    nav.classList.toggle('z-50');
                };
            }
            
            // Update UI for first step
            updateUI(0);
        }
        
        // Mode Switching Logic
        function updateSurveyMode(mode) {
            // Rebuild sections array based on selection
            if (mode === 'B2B') {
                sections = [audienceSection, ...b2bSections, contactSection];
            } else {
                sections = [audienceSection, ...b2cSections, contactSection];
            }
            
            // Re-render everything
            // Note: In a real React/Vue app this is automatic. Here we brute force re-render.
            // We want to preserve the selection in the first step (audienceSection) if possible, 
            // but for simplicity we'll just re-init and jump to step 1 (next step).
            
            initSections();
            
            // Manually re-check the radio button since re-init wiped DOM
            setTimeout(() => {
                const radio = document.querySelector(`input[name="audience_type"][value="${mode}"]`);
                if(radio) radio.checked = true;
                jumpToStep(1); // Auto advance to next step
            }, 50);
        }

        // --- RENDERING LOGIC ---

        function renderNav() {
            const nav = document.getElementById('desktop-nav');
            nav.innerHTML = sections.map((sec, idx) => `
                <button onclick="jumpToStep(${idx})" 
                    class="w-full flex items-center gap-3 px-3 py-2 rounded-md transition-colors text-sm mb-1 text-left ${idx === 0 ? 'bg-slate-800 text-white' : 'text-slate-400 hover:text-white hover:bg-slate-800'}" 
                    id="nav-btn-${idx}">
                    <i class="fas ${sec.icon} w-5 text-center"></i>
                    ${sec.title}
                </button>
            `).join('');
        }

        function renderDynamicContent() {
            // Render Industry Checkboxes (B2B only)
            const indContainer = document.getElementById('industry-selection');
            if (indContainer) {
                indContainer.innerHTML = industries.map(ind => `
                    <label class="flex items-center p-3 border rounded-lg hover:bg-slate-50 cursor-pointer transition">
                        <input type="checkbox" value="${ind}" class="w-5 h-5 text-blue-600 rounded mr-3 industry-checkbox">
                        <span class="text-sm font-medium">${ind}</span>
                    </label>
                `).join('');
            }

            // Render Matrix Builders
            renderMatrix('revenue-matrix', revenues, 's2_rev');
            renderMatrix('employee-matrix', employees, 's2_emp');
            renderMatrix('stage-matrix', stages, 's3_stage');
            renderMatrix('structure-matrix', structures, 's4_struct');
        }

        function renderMatrix(containerId, items, namePrefix) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = items.map(item => `
                <div class="flex flex-col md:flex-row md:items-center justify-between p-4 bg-slate-50 rounded-lg border border-slate-100">
                    <span class="font-medium text-slate-700 mb-2 md:mb-0">${item}</span>
                    <div class="flex gap-2">
                        ${generateRadioGroup(namePrefix, item)}
                    </div>
                </div>
            `).join('');
        }

        function generateRadioGroup(prefix, itemKey) {
            // sanitize key for ID
            const safeKey = itemKey.replace(/[^a-zA-Z0-9]/g, '');
            return `
                <label class="cursor-pointer">
                    <input type="radio" name="${prefix}_${safeKey}" value="Ideal" class="peer sr-only custom-radio">
                    <div class="px-3 py-1 rounded border border-slate-200 text-xs font-medium text-slate-500 hover:bg-white transition peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:text-green-700">Ideal</div>
                </label>
                <label class="cursor-pointer">
                    <input type="radio" name="${prefix}_${safeKey}" value="Acceptable" class="peer sr-only custom-radio">
                    <div class="px-3 py-1 rounded border border-slate-200 text-xs font-medium text-slate-500 hover:bg-white transition peer-checked:border-yellow-500 peer-checked:bg-yellow-50 peer-checked:text-yellow-700">OK</div>
                </label>
                <label class="cursor-pointer">
                    <input type="radio" name="${prefix}_${safeKey}" value="Avoid" class="peer sr-only custom-radio">
                    <div class="px-3 py-1 rounded border border-slate-200 text-xs font-medium text-slate-500 hover:bg-white transition peer-checked:border-red-500 peer-checked:bg-red-50 peer-checked:text-red-700">Avoid</div>
                </label>
            `;
        }

        function updateIndustryMatrix() {
            const selected = Array.from(document.querySelectorAll('.industry-checkbox:checked')).map(cb => cb.value);
            const container = document.getElementById('industry-matrix-container');
            const list = document.getElementById('industry-matrix');
            
            if (selected.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            list.innerHTML = selected.map(ind => `
                <div class="flex items-center justify-between p-3 bg-slate-50 rounded border border-slate-100">
                    <span class="text-sm font-semibold">${ind}</span>
                    <div class="flex gap-2">
                        ${generateRadioGroup('s1_ind_class', ind)}
                    </div>
                </div>
            `).join('');
        }

        // --- NAVIGATION LOGIC ---

        function jumpToStep(idx) {
             if (idx < 0 || idx >= sections.length) return;
             
             // Hide current
             const currEl = document.getElementById(`section-wrapper-${currentStep}`);
             if(currEl) {
                 currEl.classList.add('hidden');
                 currEl.classList.remove('block');
             }
             
             currentStep = idx;

             // Show new
             const newEl = document.getElementById(`section-wrapper-${currentStep}`);
             if(newEl) {
                 newEl.classList.remove('hidden');
                 newEl.classList.add('block');
             }

             // Update UI
             updateUI(idx);
        }

        function updateUI(idx) {
            document.getElementById('current-step-display').innerText = idx + 1;
            document.getElementById('total-steps-display').innerText = sections.length;
            
             // Progress Bar
            const pct = ((idx + 1) / sections.length) * 100;
            document.getElementById('progress-bar').style.width = `${pct}%`;

            // Sidebar Active State
            document.querySelectorAll('[id^="nav-btn-"]').forEach((btn, i) => {
                if (i === idx) {
                    btn.className = "w-full flex items-center gap-3 px-3 py-2 rounded-md transition-colors text-sm mb-1 text-left bg-slate-800 text-white shadow-lg shadow-black/20 font-medium border-l-4 border-blue-500";
                } else {
                    btn.className = "w-full flex items-center gap-3 px-3 py-2 rounded-md transition-colors text-sm mb-1 text-left text-slate-400 hover:text-white hover:bg-slate-800";
                }
            });

             // Button States
            const prevBtn = document.getElementById('prev-btn');
            prevBtn.disabled = (idx === 0);
            
            const nextBtn = document.getElementById('next-btn');
            if (idx === sections.length - 1) {
                nextBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'flex';
            }
            
             // Scroll top
            const container = document.getElementById('form-container');
            if(container) container.scrollTo(0,0);
        }

        function submitForm() {
            const form = document.getElementById('discovery-form');
            const data = new FormData(form);
            const obj = {};
            
            // Convert FormData to JSON object, handling multiple checkboxes
            for (let [key, value] of data.entries()) {
                if (obj[key]) {
                    if (!Array.isArray(obj[key])) {
                        obj[key] = [obj[key]];
                    }
                    obj[key].push(value);
                } else {
                    obj[key] = value;
                }
            }

            // Add timestamp
            obj.timestamp = new Date().toISOString();
            
            // Communicate back to parent window
            if (window.opener) {
                try {
                    window.opener.postMessage({ type: 'SURVEY_COMPLETE', data: obj }, "*");
                } catch(e) {
                    console.error("Could not post message to opener", e);
                }
            }

            const btn = document.querySelector('button[onclick="submitForm()"]');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            btn.disabled = true;

            // Mock Success
            setTimeout(() => {
                showSuccess();
            }, 1000);
        }

        function showSuccess() {
            const modal = document.getElementById('submit-modal');
            const content = document.getElementById('submit-modal-content');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);
        }

    </script>
</body>
</html>
