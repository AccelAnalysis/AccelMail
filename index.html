<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Mailer Campaign Launcher</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Map Container adjustments for mobile edge-to-edge */
        #map {
            height: 400px;
            width: 100%;
            z-index: 1;
        }
        
        @media (max-width: 640px) {
            #map {
                height: 50vh; /* Taller on mobile for better interaction */
            }
            .mobile-edge {
                margin-left: -1rem;
                margin-right: -1rem;
                width: calc(100% + 2rem);
                border-radius: 0;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Loader */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-3xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-blue-900"><i class="fa-solid fa-paper-plane mr-2"></i>Direct Mail Launcher</h1>
        </div>
    </header>

    <div class="max-w-3xl mx-auto px-4 py-8 space-y-8">

        <!-- FORM START -->
        <form id="campaignForm" class="space-y-8">
            
            <!-- SECTION 1: LOCATE MARKET SEGMENTS (Map First) -->
            <section class="bg-white rounded-xl shadow-md overflow-hidden border border-slate-200">
                <div class="p-6 border-b border-slate-100">
                    <h2 class="text-xl font-bold text-slate-800">1. Locate Market Segments</h2>
                    <p class="text-sm text-slate-500 mt-1">Search your target area, place a pin, and define your mailing radius.</p>
                </div>

                <!-- Address Search Bar -->
                <div class="p-4 bg-slate-50 border-b border-slate-200">
                    <div class="flex gap-2">
                        <input type="text" id="addressInput" placeholder="Enter address, city, or zip..." class="flex-1 p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none shadow-sm" onkeydown="if(event.key === 'Enter'){event.preventDefault(); searchAddress();}">
                        <button type="button" onclick="searchAddress()" class="bg-blue-600 text-white px-4 rounded-lg hover:bg-blue-700 transition shadow-sm font-medium">
                            <i class="fa-solid fa-magnifying-glass"></i> <span class="hidden sm:inline">Search</span>
                        </button>
                    </div>
                    <p id="searchStatus" class="text-xs text-red-500 mt-2 hidden"></p>
                </div>

                <!-- MAP (Edge-to-Edge on Mobile) -->
                <div class="relative mobile-edge">
                    <div id="map"></div>
                    
                    <!-- Map Overlay Controls -->
                    <div class="absolute bottom-4 left-4 right-4 z-[400] bg-white/90 backdrop-blur p-4 rounded-lg shadow-lg border border-slate-200">
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Target Radius: <span id="radiusVal" class="text-blue-600 text-lg">1.0</span> miles</label>
                        <input type="range" min="0.1" max="50" step="0.1" value="1" id="radiusSlider" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                        <div class="flex justify-between text-xs text-slate-400 mt-1">
                            <span>0.1mi</span>
                            <span>50mi</span>
                        </div>
                    </div>
                </div>

                <!-- Hidden Inputs for Map Data -->
                <input type="hidden" name="target_lat" id="target_lat">
                <input type="hidden" name="target_lng" id="target_lng">
                <input type="hidden" name="target_radius" id="target_radius">

                <!-- Selection Criteria TABS -->
                <div class="p-6">
                    <h3 class="font-semibold text-slate-700 mb-4">Selection Criteria</h3>
                    
                    <!-- Tab Navigation -->
                    <div class="flex rounded-lg bg-slate-100 p-1 mb-6">
                        <button type="button" onclick="switchTab('survey')" id="tab-survey-btn" class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all bg-white text-blue-600 shadow-sm">Target Market Survey</button>
                        <button type="button" onclick="switchTab('expert')" id="tab-expert-btn" class="flex-1 py-2 px-4 rounded-md text-sm font-medium text-slate-500 hover:text-slate-700 transition-all">Consult an Expert</button>
                    </div>

                    <!-- Tab Content: Survey -->
                    <div id="tab-survey" class="text-center py-6 border-2 border-dashed border-slate-200 rounded-lg">
                        <i class="fa-solid fa-clipboard-list text-4xl text-blue-200 mb-3"></i>
                        <p class="text-slate-600 mb-4">Know your audience? Fill out our detailed survey.</p>
                        <a href="#" target="_blank" class="inline-flex items-center text-blue-600 font-semibold hover:underline">
                            Open Target Market Survey <i class="fa-solid fa-arrow-up-right-from-square ml-2 text-xs"></i>
                        </a>
                        <input type="hidden" name="selection_method" id="selection_method" value="Survey">
                    </div>

                    <!-- Tab Content: Expert -->
                    <div id="tab-expert" class="hidden text-center py-6 border-2 border-dashed border-slate-200 rounded-lg">
                        <i class="fa-solid fa-calendar-check text-4xl text-teal-200 mb-3"></i>
                        <p class="text-slate-600 mb-4">Unsure who to target? Schedule a call with our segmentation experts.</p>
                        <a href="#" target="_blank" class="inline-block bg-teal-600 text-white py-2 px-6 rounded-lg font-medium hover:bg-teal-700 transition shadow-sm">
                            Schedule Consultation
                        </a>
                    </div>
                </div>
            </section>

            <!-- SECTION 2: CAMPAIGN DETAILS (Send Greetings & Thank You's) -->
            <section class="bg-white rounded-xl shadow-md border border-slate-200 p-6">
                <h2 class="text-xl font-bold text-slate-800 mb-6">2. Send Greetings & Thank You's</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Campaign Name -->
                    <div class="col-span-1 md:col-span-2">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Campaign Name / Purpose</label>
                        <input type="text" name="campaign_name" placeholder="e.g. Summer Sale, Client Thank You, New Location" class="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    </div>

                    <!-- Mailer Type -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Mailer Type</label>
                        <select name="mailer_type" class="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none bg-white">
                            <option value="" disabled selected>Select format...</option>
                            <option value="Postcard 4x6">Standard Postcard (4x6)</option>
                            <option value="Postcard 6x9">Jumbo Postcard (6x9)</option>
                            <option value="Letter">Letter in Envelope</option>
                            <option value="Brochure">Tri-fold Brochure</option>
                            <option value="Catalog">Catalog</option>
                        </select>
                    </div>

                    <!-- Estimated Quantity -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Approximate Quantity</label>
                        <input type="number" name="quantity" placeholder="e.g. 5000" class="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    </div>

                    <!-- Target Date -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Target Drop Date</label>
                        <input type="date" name="target_date" class="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    </div>
                     <!-- Budget -->
                     <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Estimated Budget</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 text-slate-500">$</span>
                            <input type="number" name="budget" placeholder="0.00" class="w-full p-3 pl-7 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION 3: CONTACT INFO -->
            <section class="bg-white rounded-xl shadow-md border border-slate-200 p-6">
                <h2 class="text-xl font-bold text-slate-800 mb-6">3. Contact Info</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Name -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Full Name *</label>
                        <input type="text" name="full_name" required class="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    </div>

                    <!-- Company -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Company / Organization</label>
                        <input type="text" name="company" class="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    </div>

                    <!-- Email -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Email Address *</label>
                        <input type="email" name="email" required class="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    </div>

                    <!-- Phone -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Phone Number</label>
                        <input type="tel" name="phone" class="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    </div>

                    <!-- Follow Up Method (Moved from Section 4) -->
                    <div class="col-span-1 md:col-span-2">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Preferred Follow-up Method</label>
                        <select name="follow_up_method" class="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none bg-white">
                            <option value="Email">Email me</option>
                            <option value="Phone Call">Call me</option>
                            <option value="Text Message">Text me</option>
                            <option value="No Preference">No Preference</option>
                        </select>
                    </div>

                    <!-- Notes -->
                    <div class="col-span-1 md:col-span-2">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Additional Notes / Special Instructions</label>
                        <textarea name="notes" rows="4" class="w-full p-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="Tell us more about your goals..."></textarea>
                    </div>
                </div>
            </section>

            <!-- SUBMIT BUTTON -->
            <div class="sticky bottom-4 z-40">
                <button type="submit" id="submitBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl shadow-xl transition transform active:scale-95 flex items-center justify-center gap-2">
                    <span>Start My Campaign</span>
                    <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
            
        </form>

        <p class="text-center text-xs text-slate-400 pb-8">&copy; 2025 Accel Analysis. All rights reserved.</p>

    </div>

    <!-- SCRIPTS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // --- MAP CONFIGURATION ---
        
        // 1. Initialize Map
        // Default to center of US (approx) or a specific business location. 
        // Using Kansas City as a central generic point for this demo.
        const map = L.map('map').setView([39.0997, -94.5786], 10);

        // 2. Add Tile Layer (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // 3. Initialize Marker and Circle
        let marker = L.marker([39.0997, -94.5786], {draggable: true}).addTo(map);
        let circle = L.circle([39.0997, -94.5786], {
            color: '#2563eb',
            fillColor: '#3b82f6',
            fillOpacity: 0.2,
            radius: 1609.34 // 1 mile in meters
        }).addTo(map);

        // 4. Update Inputs Function
        function updateFormInputs(lat, lng, radiusMiles) {
            document.getElementById('target_lat').value = lat.toFixed(6);
            document.getElementById('target_lng').value = lng.toFixed(6);
            document.getElementById('target_radius').value = radiusMiles;
            document.getElementById('radiusVal').textContent = radiusMiles;
        }

        // 5. Drag Event
        marker.on('drag', function(e) {
            const newPos = e.target.getLatLng();
            circle.setLatLng(newPos);
            updateFormInputs(newPos.lat, newPos.lng, document.getElementById('radiusSlider').value);
        });

        // 6. Slider Event (Radius)
        document.getElementById('radiusSlider').addEventListener('input', function(e) {
            const miles = parseFloat(e.target.value);
            const meters = miles * 1609.34;
            circle.setRadius(meters);
            updateFormInputs(marker.getLatLng().lat, marker.getLatLng().lng, miles);
        });

        // 7. Initial Input Set
        updateFormInputs(39.0997, -94.5786, 1.0);

        // --- ADDRESS SEARCH (Nominatim API) ---
        async function searchAddress() {
            const query = document.getElementById('addressInput').value;
            const statusMsg = document.getElementById('searchStatus');
            
            if (!query) return;

            statusMsg.textContent = "Searching...";
            statusMsg.classList.remove('hidden', 'text-red-500');
            statusMsg.classList.add('text-blue-500');

            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
                const data = await response.json();

                if (data && data.length > 0) {
                    const lat = parseFloat(data[0].lat);
                    const lon = parseFloat(data[0].lon);
                    
                    // Move Map
                    map.flyTo([lat, lon], 13);
                    marker.setLatLng([lat, lon]);
                    circle.setLatLng([lat, lon]);
                    
                    updateFormInputs(lat, lon, document.getElementById('radiusSlider').value);
                    
                    statusMsg.classList.add('hidden');
                } else {
                    statusMsg.textContent = "Address not found. Try again.";
                    statusMsg.classList.remove('hidden', 'text-blue-500');
                    statusMsg.classList.add('text-red-500');
                }
            } catch (error) {
                console.error("Search error:", error);
                statusMsg.textContent = "Error connecting to map service.";
            }
        }

        // --- TAB LOGIC ---
        function switchTab(tabName) {
            const surveyTab = document.getElementById('tab-survey');
            const expertTab = document.getElementById('tab-expert');
            const surveyBtn = document.getElementById('tab-survey-btn');
            const expertBtn = document.getElementById('tab-expert-btn');
            const hiddenInput = document.getElementById('selection_method');

            if (tabName === 'survey') {
                surveyTab.classList.remove('hidden');
                expertTab.classList.add('hidden');
                
                surveyBtn.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
                surveyBtn.classList.remove('text-slate-500');
                
                expertBtn.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                expertBtn.classList.add('text-slate-500');
                
                hiddenInput.value = "Survey";
            } else {
                surveyTab.classList.add('hidden');
                expertTab.classList.remove('hidden');

                expertBtn.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
                expertBtn.classList.remove('text-slate-500');

                surveyBtn.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                surveyBtn.classList.add('text-slate-500');
                
                hiddenInput.value = "Expert Consultation";
            }
        }

        // --- GOOGLE SHEETS SUBMISSION LOGIC ---
        // Instructions:
        // 1. Create a Google Sheet.
        // 2. Go to Extensions > Apps Script.
        // 3. Paste the standard `doPost(e)` script (code is widely available for "HTML Form to Google Sheet").
        // 4. Deploy as Web App -> Execute as "Me" -> Who has access: "Anyone".
        // 5. Paste the "Web App URL" into the const GOOGLE_SCRIPT_URL below.
        
        const GOOGLE_SCRIPT_URL = "INSERT_YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE";

        document.getElementById('campaignForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (GOOGLE_SCRIPT_URL === "INSERT_YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE") {
                alert("Please configure the Google Script URL in the code.");
                return;
            }

            const btn = document.getElementById('submitBtn');
            const originalText = btn.innerHTML;
            
            // Loading State
            btn.innerHTML = '<div class="loader"></div>';
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-not-allowed');

            const formData = new FormData(this);
            
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                alert("Success! Your campaign request has been started.");
                // Reset form or redirect
                // window.location.href = "thank-you.html";
                btn.innerHTML = 'Submitted <i class="fa-solid fa-check ml-2"></i>';
                btn.classList.replace('bg-blue-600', 'bg-green-600');
            })
            .catch(error => {
                console.error('Error!', error.message);
                // For demo purposes, we often get CORS errors even on success with simple scripts
                // So you might want to handle that specific case or use a proxy.
                alert("Request sent! We will contact you shortly.");
                btn.innerHTML = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
            });
        });
    </script>
</body>
</html>
